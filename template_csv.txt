もちろん！以下は DjangoプロジェクトでCSVを使って競走馬を一括登録する手順 を、初めての人でも分かるように丁寧に説明します。

⸻

✅ 1. CSVファイルを作成する

まず、oaks_2025.csv というファイルを以下のような内容で作ります。

📄 oaks_2025.csv（例）

horse_name,race_name
エンブロイダリー,オークス
アルマヴェローチェ,オークス
リンクスティップ,オークス
カムニャック,オークス
エリカエクスプレス,オークス
パラディレーヌ,オークス
ルージュソリテール,オークス
ビップデイジー,オークス
レーゼドラマ,オークス
ブラウンラチェット,オークス
エストゥペンダ,オークス
サヴォンリンナ,オークス
タイセイプランセス,オークス
タガノアビー,オークス
ゴーソーファー,オークス
ケリフレッドアスク,オークス
ウィルサヴァイブ,オークス
アイサンサン,オークス
サタデーサンライズ,オークス
レーヴドロペラ,オークス

保存場所：

Djangoプロジェクトの ルートディレクトリ（manage.pyがある場所）に置く。

⸻

✅ 2. 管理コマンド import_horses.py を作る

prediction/management/commands/import_horses.py に以下を保存：

import csv
from django.core.management.base import BaseCommand
from prediction.models import Horse, Race

class Command(BaseCommand):
    help = 'Import horses from a CSV file'

    def add_arguments(self, parser):
        parser.add_argument('csv_file', type=str)

    def handle(self, *args, **options):
        csv_file = options['csv_file']
        with open(csv_file, newline='', encoding='utf-8') as f:
            reader = csv.DictReader(f)
            for row in reader:
                race_name = row['race_name']
                horse_name = row['horse_name']

                race, _ = Race.objects.get_or_create(name=race_name)
                Horse.objects.get_or_create(name=horse_name, race=race)

        self.stdout.write(self.style.SUCCESS('✅ Horses imported successfully.'))


⸻

✅ 3. 実行コマンド

python manage.py import_horses oaks_2025.csv

これで Race に「オークス」が追加され、その出走馬が Horse モデルに関連付けられて登録されます。

⸻

✅ 4. データベース確認方法（Djangoシェル）

python manage.py shell

そして以下を入力：

from prediction.models import Race, Horse

race = Race.objects.get(name="オークス")
horses = race.horse_set.all()  # related_name指定がない場合
print(horses.count())  # 登録された馬の数（20頭）
for horse in horses:
    print(horse.name)


⸻

✅ 5. よくあるミスとチェックポイント

ミス内容	対処法
FileNotFoundError	CSVファイルが正しい場所にあるか確認（manage.pyと同じ場所）
FieldError（raceがない）	Horseモデルに race = models.ForeignKey(Race, on_delete=..., ...) があるか確認
文字化け	UTF-8で保存されているか確認


⸻

もし related_name='horses' を設定してる場合は：

race.horses.all()


⸻

これでどのレースでも CSVから一発登録＆確認 ができます！
次に入れたいレースがあれば、同じ形式のCSVを作って読み込ませればOKです。やりたいレース名を教えてくれればCSVも一緒に作成しますよ。
