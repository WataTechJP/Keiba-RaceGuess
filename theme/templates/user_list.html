<!-- prettier-ignore -->
{% extends "base.html" %}
{% block title %}ãƒ•ãƒ¬ãƒ³ãƒ‰ä¸€è¦§{% endblock %}

{% block content %}
<h1 class="text-2xl font-bold text-blue-600 mb-2">ãƒ•ãƒ¬ãƒ³ãƒ‰</h1>

<ul>
  {% for u in users %}
  <li class="flex items-center justify-between border p-4 rounded">
    <span>{{ u.username }}</span>
    {% if u.id in followed_users %}
    <form method="POST" action="{% url 'unfollow_user' u.id %}">
      {% csrf_token %}
      <button class="text-red-500 hover:underline">ãƒ•ã‚©ãƒ­ãƒ¼è§£é™¤</button>
    </form>
    {% else %}
    <form method="POST" action="{% url 'follow_user' u.id %}">
      {% csrf_token %}
      <button class="text-blue-500 hover:underline">ãƒ•ã‚©ãƒ­ãƒ¼ã™ã‚‹</button>
    </form>
    {% endif %}
  </li>
  {% endfor %}
</ul>

{% if users %} {% else %}
<!-- ç°¡å˜ãªãƒ•ã‚©ãƒ­ãƒ¼ä¸­ãƒ¦ãƒ¼ã‚¶ãƒ¼è¡¨ç¤ºï¼ˆæ—¢å­˜ã®usersã‹ã‚‰ãƒ•ã‚£ãƒ«ã‚¿ï¼‰ -->
<div class="mt-6 bg-white rounded-xl shadow-lg p-6">
  <h2 class="text-xl font-semibold text-gray-800 mb-4">
    ğŸ‘¥ ãƒ•ã‚©ãƒ­ãƒ¼ä¸­ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼
  </h2>
  <div class="text-center py-8">
    <div class="text-4xl mb-3">ğŸ‘¤</div>
    <h3 class="text-lg font-semibold text-gray-700 mb-2">
      ã¾ã ãƒ•ã‚©ãƒ­ãƒ¼ã—ã¦ã„ã‚‹ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒã„ã¾ã›ã‚“
    </h3>
    <p class="text-gray-500 text-sm">
      ä¸Šã®æ¤œç´¢æ©Ÿèƒ½ã‚’ä½¿ã£ã¦ã€ãƒ•ãƒ¬ãƒ³ãƒ‰ã‚’è¦‹ã¤ã‘ã¦ãƒ•ã‚©ãƒ­ãƒ¼ã—ã¦ã¿ã¾ã—ã‚‡ã†ï¼
    </p>
  </div>
</div>
{% endif %}

<!-- ãƒ•ãƒ¬ãƒ³ãƒ‰æ¤œç´¢ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
<div class="bg-white rounded-xl shadow-lg p-6 mb-8">
  <h2 class="text-xl font-semibold text-gray-800 mb-4">ğŸ” ãƒ•ãƒ¬ãƒ³ãƒ‰ã‚’æ¤œç´¢</h2>

  <form method="GET" class="space-y-4">
    <div>
      <label class="block text-sm font-semibold text-gray-700 mb-2">
        ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã¾ãŸã¯ãƒ¦ãƒ¼ã‚¶ãƒ¼åã§æ¤œç´¢
      </label>
      <div class="flex space-x-3">
        <input
          type="text"
          name="search"
          value="{{ request.GET.search }}"
          placeholder="example@email.com ã¾ãŸã¯ ãƒ¦ãƒ¼ã‚¶ãƒ¼å"
          class="flex-1 px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition"
        />
        <button
          type="submit"
          class="bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700 transition font-semibold"
        >
          æ¤œç´¢
        </button>
      </div>
    </div>

    {% if request.GET.search %}
    <div class="flex items-center justify-between bg-blue-50 p-3 rounded-lg">
      <span class="text-blue-800">
        <strong>"{{ request.GET.search }}"</strong> ã®æ¤œç´¢çµæœ
      </span>
      <a
        href="{% url 'user_list' %}"
        class="text-blue-600 hover:underline text-sm"
      >
        æ¤œç´¢ã‚’ã‚¯ãƒªã‚¢
      </a>
    </div>
    {% endif %}
  </form>
</div>

<!-- æ¤œç´¢æ™‚ã®ã¿ãƒ¦ãƒ¼ã‚¶ãƒ¼è¡¨ç¤º -->
{% if request.GET.search %}
<div class="bg-white rounded-xl shadow-lg p-6">
  <h2 class="text-xl font-semibold text-gray-800 mb-4">
    æ¤œç´¢çµæœ {% if users %}
    <span class="text-sm text-gray-500">({{ users|length }}äºº)</span>
    {% endif %}
  </h2>

  {% if users %}
  <div class="space-y-3">
    {% for u in users %}
    <div
      class="flex items-center justify-between border border-gray-200 p-4 rounded-lg hover:bg-gray-50 transition"
    >
      <!-- ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ± -->
      <div class="flex items-center space-x-4">
        <div
          class="w-12 h-12 bg-gradient-to-r from-blue-500 to-purple-600 rounded-full flex items-center justify-center text-white font-bold text-lg"
        >
          {{ u.username|first|upper }}
        </div>
        <div>
          <h3 class="font-semibold text-gray-800">{{ u.username }}</h3>
          <p class="text-sm text-gray-500">{{ u.email }}</p>
          {% if u.userprofile.bio %}
          <p class="text-xs text-gray-400 mt-1">
            {{ u.userprofile.bio|truncatechars:50 }}
          </p>
          {% endif %}
        </div>
      </div>

      <!-- ãƒ•ã‚©ãƒ­ãƒ¼ãƒœã‚¿ãƒ³ -->
      <div class="flex items-center space-x-3">
        {% if u.id == user.id %}
        <span class="bg-gray-100 text-gray-500 px-4 py-2 rounded-lg text-sm">
          ã‚ãªãŸ
        </span>
        {% elif u.id in followed_users %}
        <form
          method="POST"
          action="{% url 'unfollow_user' u.id %}"
          class="inline"
        >
          {% csrf_token %}
          <button
            type="submit"
            class="bg-red-100 text-red-600 hover:bg-red-200 px-4 py-2 rounded-lg text-sm font-semibold transition"
          >
            âœ“ ãƒ•ã‚©ãƒ­ãƒ¼ä¸­
          </button>
        </form>
        {% else %}
        <form
          method="POST"
          action="{% url 'follow_user' u.id %}"
          class="inline"
        >
          {% csrf_token %}
          <button
            type="submit"
            class="bg-blue-600 text-white hover:bg-blue-700 px-4 py-2 rounded-lg text-sm font-semibold transition"
          >
            + ãƒ•ã‚©ãƒ­ãƒ¼ã™ã‚‹
          </button>
        </form>
        {% endif %}
      </div>
    </div>
    {% endfor %}
  </div>
  {% else %}
  <div class="text-center py-12">
    <div class="text-6xl mb-4">ğŸ”</div>
    <h3 class="text-xl font-semibold text-gray-700 mb-2">
      æ¤œç´¢çµæœãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“
    </h3>
    <p class="text-gray-500 mb-4">
      ã€Œ{{ request.GET.search }}ã€ã«ä¸€è‡´ã™ã‚‹ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚
    </p>
    <p class="text-sm text-gray-400">
      æ­£ç¢ºãªãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã¾ãŸã¯ãƒ¦ãƒ¼ã‚¶ãƒ¼åã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚
    </p>
  </div>
  {% endif %}
</div>
{% else %}
<!-- æ¤œç´¢å‰ã®åˆæœŸè¡¨ç¤º -->
<div class="bg-white rounded-xl shadow-lg p-8 text-center">
  <div class="text-6xl mb-4">ğŸ‘‹</div>
  <h2 class="text-2xl font-semibold text-gray-800 mb-3">
    ãƒ•ãƒ¬ãƒ³ãƒ‰ã‚’è¦‹ã¤ã‘ã‚ˆã†ï¼
  </h2>
  <p class="text-gray-600 mb-6">
    ä¸Šã®æ¤œç´¢ãƒœãƒƒã‚¯ã‚¹ã«ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã¾ãŸã¯ãƒ¦ãƒ¼ã‚¶ãƒ¼åã‚’å…¥åŠ›ã—ã¦ã€<br />
    ãƒ•ãƒ¬ãƒ³ãƒ‰ã‚’æ¤œç´¢ã—ã¦ã¿ã¦ãã ã•ã„ã€‚
  </p>
  <div
    class="bg-blue-50 border border-blue-200 rounded-lg p-4 max-w-md mx-auto"
  >
    <h4 class="text-blue-800 font-semibold mb-2">ğŸ’¡ æ¤œç´¢ã®ã‚³ãƒ„</h4>
    <ul class="text-sm text-blue-700 text-left space-y-1">
      <li>â€¢ å®Œå…¨ãªãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’å…¥åŠ›</li>
      <li>â€¢ ãƒ¦ãƒ¼ã‚¶ãƒ¼åã®ä¸€éƒ¨ã§ã‚‚æ¤œç´¢å¯èƒ½</li>
      <li>â€¢ å¤§æ–‡å­—ãƒ»å°æ–‡å­—ã¯åŒºåˆ¥ã•ã‚Œã¾ã›ã‚“</li>
    </ul>
  </div>
</div>
<a href="{% url 'timeline' %}" class="text-sm text-gray-500 mt-4 block"
  >â† ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³ã¸æˆ»ã‚‹</a
>
{% endif %} {% endblock %}
